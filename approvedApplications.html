<?php
    session_start();
    require("./scripts/post_variables.php");

    $_SESSION['last_visited'] = "reqs.html";

    if(isset($_SESSION['pfp'])){
        $pfp = $_SESSION['pfp'];
    }
    if(isset($_SESSION['group_type'])){
        $group_type = $_SESSION['group_type'];
    }
?>
<!DOCTYPE html>
<html lang="el">
    <head>

        <link href="styles/header.css" rel="stylesheet" type="text/css">
        <link href="styles/footer.css" rel="stylesheet" type="text/css">
        <link href="styles/unis.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
        <meta name="author" content="Αργυρός Κωνσταντίνος">
        <meta name="description" content="Επίσημη σελίδα πληροφοριών για πρακτική άσκηση Erasmus">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8"/>
        <title>Erasmus Requirements Page</title>
    </head>
    <body>

        <!--Topbar Navigation Code-->
        <div class="header" id="header">
            <div class="header-container">
                <a class="logo" href="index.html"><img src="./media/photos/logo.png"></a>

                <div class="header-middle">
                    <a href="index.html">Αρχική</a>
                    <a href="more.html">Περισσότερα</a>
                    <a href="reqs.html">Προϋποθέσεις</a>
                    <?php
                        if($_SESSION['approved_applications']){
                            echo '<a href="approvedApplications.html">Νέα</a>';
                        }

                        if(isset($_SESSION['group_type'])){
                            echo '<a href="application.html">Αίτηση</a>';


                            if($group_type == "administrator"){
                                echo '<a href="admin.html">Διαχείριση</a>';
                            }
                        }
                    ?>
                </div>
                <div class="header-right">
                    <div class="seperator"></div>
                    <?php
                        if(isset($_SESSION['pfp'])){
                            echo '<a class="pfp" href="profile.html"><img src="';
                            echo $pfp.'"></a>';
                        }
                        else{
                            echo '<a class="signup" href="sign-up.html">Εγγραφή</a>';
                            echo '<a class="login" href="login.html">Σύνδεση</a>';
                        }
                    ?>
                    <a class="language-button-gr"><img src="media/photos/gr-icon.jpg"></a>
                    <a class="language-button-en"><img src="media/photos/en-icon.jpg"></a>
                    </label>
                    
                </div>
            </div>
        </div>
        <!--Topbar Navigation Code-->

        <div class="header-content">
            <div class="reqs">
                <div class="reqs-table">
                    <table name="table" id="table" cellspacing="0">
                        <th colspan="9">ΑΠΟΔΕΚΤΕΣ ΑΙΤΗΣΕΙΣ</th>

                        <?php
                            // Connecting to database

                            require "./scripts/credentials.php";

                            $con = mysqli_connect($host,$user,$password);
                            if (!$con){
                                echo "problem in the connection"/* .mysqli_error() */;
                                die;
                            }
                            mysqli_select_db($con, $db);

                            // Query to get all applications
                            $query = "  SELECT *
                                        FROM APPLICATIONS, APPLIED, USERS
                                        WHERE APPLICATIONS.id = APPLIED.app_id
                                        AND USERS.id = APPLIED.user_id
                                        AND status = 'approved'";
                
                            // var_dump($query);   
                        
                            // Getting applications from server
                            $result = mysqli_query($con, $query);
                        
                            $marked = true;
                            $class = "";
                            
                            $loops = mysqli_num_rows($result);

                            for($i = 0; $i < $loops; $i++){

                                $rows = mysqli_fetch_assoc($result);
                                // var_dump($rows);

                                $rows_pfp = $rows['pfp'];
                                $rows_fname = $rows['fname'];
                                $rows_lname = $rows['lname'];
                                $rows_am = $rows['am'];
                                $rows_email = $rows['email'];
                                $rows_percentage = $rows['percentage'];
                                $rows_average = $rows['average'];
                                $rows_english_level = $rows['english_level'];
                                $rowspfp = $rows['pfp'];

                                $rows_pfp = substr($rows_pfp, 1);

                                $marked = !$marked;
                                if($marked){
                                    $class = "marked";
                                }
                                else{
                                    $class = "unmarked";
                                }
                                echo "<tr class=\"$class\"><td><img src=\"$rows_pfp\"></td><td>$rows_fname</td><td>$rows_lname</td><td>$rows_am</td><td>$rows_email</td><td>$rows_percentage</td><td>$rows_average</td><td>$rows_english_level</td></tr>";
                            }
                        ?>
                    </table>
                </div>
            </div>
            
            <!--Footer Code-->
            <div class="footer">
                <ul class="socials">
                    <li><a href="https://www.facebook.com/groups/erasmus.youthinaction/?locale=el_GR" class="fa fa-facebook"></a></li>
                    <li><a href="https://twitter.com/EUErasmusPlus" class="fa fa-twitter"></a></li>
                    <li><a href="https://www.instagram.com/erasmusplusprojects/?hl=el" class="fa fa-instagram"></a></li>
                    <li><a href="https://www.youtube.com/@europeanparliament" class="fa fa-youtube"></a></li>
                    <li><a href="https://www.reddit.com/r/Erasmus/" class="fa fa-reddit"></a></li>
                    <li><a href="https://www.linkedin.com/company/meterasmusplus/" class="fa fa-linkedin"></a></li>
                </ul>
                <section class="footer-logo">
                    <a href="https://commission.europa.eu/legal-notice_en">ERASMUS</a> 
                </section>
                <section class="footer-copyright">
                    <a href="https://commission.europa.eu/legal-notice_en">Copyright © 2023 Erasmus, Inc.</a> 
                    <!--to type C press alt + 0 1 6 9 from numpad-->
                </section>
            </div>
            <!--Footer Code-->

        </div>
        
    </body>
    <!-- <script src="scripts/results.js"></script>      -->
    <script src="scripts/stickyHeader.js"></script>     
</html>